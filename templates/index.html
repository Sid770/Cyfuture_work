<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Interview System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success: linear-gradient(135deg, #81FBB8 0%, #28C76F 100%);
            --warning: linear-gradient(135deg, #FFD93D 6%, #FF6B6B 100%);
            --error: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --dark-glass: rgba(0, 0, 0, 0.1);
            --text-primary: #1a1a1a;
            --text-secondary: #6b7280;
            --text-light: rgba(255, 255, 255, 0.9);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%23ffffff" fill-opacity="0.05"><circle cx="7" cy="7" r="1"/><circle cx="27" cy="7" r="1"/><circle cx="47" cy="7" r="1"/><circle cx="7" cy="27" r="1"/><circle cx="27" cy="27" r="1"/><circle cx="47" cy="27" r="1"/><circle cx="7" cy="47" r="1"/><circle cx="27" cy="47" r="1"/><circle cx="47" cy="47" r="1"/></g></g></svg>');
            pointer-events: none;
            z-index: 0;
        }

        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .shape {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        .shape:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 60%;
            right: 10%;
            animation-delay: -7s;
        }

        .shape:nth-child(3) {
            width: 60px;
            height: 60px;
            top: 80%;
            left: 70%;
            animation-delay: -3s;
        }

        @keyframes float {
            from {
                transform: translateY(0px) rotate(0deg);
            }
            to {
                transform: translateY(-100vh) rotate(360deg);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.8s ease-out;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .header p {
            color: var(--text-light);
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .nav-btn {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 12px 24px;
            color: var(--text-light);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-btn.active {
            background: var(--primary);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }

        .glass-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--accent);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .file-upload-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            border: 2px dashed var(--glass-border);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            padding: 24px;
            text-align: center;
        }

        .file-input-container:hover {
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.02);
        }

        .file-input {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        .file-label {
            display: block;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .file-label:hover {
            color: #ffffff;
        }

        .file-icon {
            font-size: 2rem;
            margin-bottom: 12px;
            opacity: 0.7;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            font-family: inherit;
            margin: 10px 5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--secondary);
            box-shadow: 0 8px 24px rgba(240, 147, 251, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 12px 32px rgba(240, 147, 251, 0.4);
        }

        .btn-danger {
            background: var(--error);
            box-shadow: 0 8px 24px rgba(255, 107, 107, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 12px 32px rgba(255, 107, 107, 0.4);
        }

        .btn-success {
            background: var(--success);
            box-shadow: 0 8px 24px rgba(129, 251, 184, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 12px 32px rgba(129, 251, 184, 0.4);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            align-items: center;
            margin-bottom: 32px;
        }

        .question-display, .transcript-display {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            min-height: 60px;
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .question-display {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-left: 4px solid #667eea;
        }

        .transcript-display {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1));
            border-left: 4px solid #4facfe;
            min-height: 100px;
        }

        .hidden {
            display: none;
        }

        .status {
            padding: 16px 20px;
            margin: 16px 0;
            border-radius: 12px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideIn 0.3s ease-out;
        }

        .status.success {
            background: rgba(129, 251, 184, 0.15);
            color: #10b981;
            border-color: rgba(129, 251, 184, 0.3);
        }

        .status.error {
            background: rgba(255, 107, 107, 0.15);
            color: #ef4444;
            border-color: rgba(255, 107, 107, 0.3);
        }

        .overall-score {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 24px;
            text-align: center;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-grid {
            display: grid;
            gap: 16px;
            list-style: none;
        }

        .score-item {
            padding: 20px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .score-item:hover {
            transform: translateX(8px);
        }

        .score-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--accent);
        }

        .results-table {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 16px;
            font-weight: 600;
            color: var(--text-light);
            border-bottom: 1px solid var(--glass-border);
        }

        .table-row {
            padding: 16px;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 16px;
            color: var(--text-light);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .table-row:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .score-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
        }

        .score-excellent {
            background: rgba(129, 251, 184, 0.2);
            color: #10b981;
            border: 1px solid rgba(129, 251, 184, 0.3);
        }

        .score-good {
            background: rgba(255, 211, 61, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(255, 211, 61, 0.3);
        }

        .score-poor {
            background: rgba(255, 107, 107, 0.2);
            color: #ef4444;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.8rem;
            margin: 0;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .listening-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .listening-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: listening 1.5s infinite ease-in-out;
        }

        .listening-dot:nth-child(2) { animation-delay: 0.2s; }
        .listening-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes listening {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .glass-card {
                padding: 24px;
                margin-bottom: 24px;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .btn {
                padding: 14px 24px;
                font-size: 0.9rem;
            }

            .table-header, .table-row {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .navigation {
                flex-direction: column;
                align-items: center;
            }
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .candidate-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            border-left: 4px solid var(--accent);
        }

        .candidate-info h3 {
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .candidate-info p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-state h3 {
            margin-bottom: 16px;
            font-size: 1.5rem;
        }

        .empty-state p {
            font-size: 1rem;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>HireIntelIQ</h1>
            <p>Advanced AI-Powered Voice Interview System</p>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-btn active" onclick="showSection('interview')">üìù New Interview</button>
            <button class="nav-btn" onclick="showSection('results')">üìä Results Dashboard</button>
        </div>
        
        <!-- Interview Section -->
        <div id="interview" class="section active">
            <!-- Candidate Info -->
            <div class="glass-card">
                <h2 class="section-title">
                    üë§ Candidate Information
                </h2>
                <div class="form-group">
                    <label for="candidateName">Full Name *</label>
                    <input type="text" id="candidateName" class="form-input" placeholder="Enter candidate's full name" required>
                </div>
                <div class="form-group">
                    <label for="candidateEmail">Email Address</label>
                    <input type="email" id="candidateEmail" class="form-input" placeholder="Enter candidate's email address">
                </div>
                <div class="form-group">
                    <label for="candidatePosition">Position Applied For</label>
                    <input type="text" id="candidatePosition" class="form-input" placeholder="e.g. Software Engineer, Data Analyst">
                </div>
            </div>

            <!-- File Upload Section -->
            <div class="glass-card upload-section">
                <h2 class="section-title">
                    üìÅ Upload Documents
                </h2>
                <div class="file-upload-wrapper">
                    <div class="file-input-container">
                        <div class="file-icon">üìÑ</div>
                        <label for="resume" class="file-label">
                            <strong>Upload Resume</strong><br>
                            <small>PDF, DOCX, or TXT format</small>
                        </label>
                        <input type="file" id="resume" class="file-input" accept=".pdf,.docx,.txt">
                    </div>
                </div>
                <div class="file-upload-wrapper">
                    <div class="file-input-container">
                        <div class="file-icon">üìã</div>
                        <label for="jd" class="file-label">
                            <strong>Upload Job Description</strong><br>
                            <small>PDF, DOCX, or TXT format</small>
                        </label>
                        <input type="file" id="jd" class="file-input" accept=".pdf,.docx,.txt">
                    </div>
                </div>
                <div style="text-align: center; margin-top: 24px;">
                    <button id="startInterview" class="btn">
                        ‚ú® Generate Questions
                    </button>
                </div>
                <div id="uploadStatus"></div>
            </div>

            <!-- Audio Controls Section -->
            <div id="audioControls" class="hidden">
                <div class="glass-card interview-section">
                    <h2 class="section-title">
                        üé§ Voice Interview
                    </h2>
                    
                    <div id="currentCandidateInfo" class="candidate-info">
                        <h3>Current Candidate: <span id="currentName">-</span></h3>
                        <p>Position: <span id="currentPosition">-</span> | Email: <span id="currentEmail">-</span></p>
                    </div>
                    
                    <p style="color: var(--text-light); margin-bottom: 24px; text-align: center;">
                        Questions have been generated successfully. Click below to begin your voice interview.
                    </p>
                     
                    <div class="controls-grid">
                        <button id="startInterviewVoice" class="btn btn-secondary">
                            üé§ Start Voice Interview
                        </button>
                        <button id="stopButton" class="btn btn-danger">
                            ‚èπÔ∏è Stop Current Answer
                        </button>
                    </div>
                    
                    <div id="interviewStatus">
                        <h3 style="color: var(--text-light); margin-bottom: 12px; font-weight: 600;">
                            üìã Current Question:
                        </h3>
                        <div id="currentQuestion" class="question-display">
                            Ready to begin interview...
                        </div>
                        
                        <h3 style="color: var(--text-light); margin-bottom: 12px; margin-top: 24px; font-weight: 600;">
                            üó£Ô∏è Your Response:
                        </h3>
                        <div id="transcript" class="transcript-display">
                            Waiting for interview to start...
                        </div>
                        
                        <h3 style="color: var(--text-light); margin-bottom: 12px; margin-top: 24px; font-weight: 600;">
                            ‚úÖ Final Answer:
                        </h3>
                        <div id="answer" class="transcript-display">
                            No answer recorded yet...
                        </div>
                    </div>
                </div>

                <!-- Scoring Section -->
                <div class="glass-card scores">
                    <h2 class="section-title">
                        üìä Interview Results
                    </h2>
                    <div id="overallScore" class="overall-score">
                        Scores will appear after interview completion
                    </div>
                    <ul id="scoreList" class="score-grid"></ul>
                    
                    <div style="text-align: center; margin-top: 24px;">
                        <button id="startNewInterview" class="btn btn-success hidden">
                            üîÑ Start New Interview
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="section">
            <div class="glass-card">
                <h2 class="section-title">
                    üìä Results Dashboard
                </h2>
                
                <div style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                    <div>
                        <label for="sortBy" style="color: var(--text-light); margin-right: 12px;">Sort by:</label>
                        <select id="sortBy" class="form-input" style="width: auto; display: inline-block;">
                            <option value="score">Overall Score</option>
                            <option value="name">Name</option>
                            <option value="timestamp">Interview Date</option>
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="refreshResults()">üîÑ Refresh</button>
                        <button class="btn btn-success" onclick="exportResults()">üì• Export CSV</button>
                        <button class="btn btn-danger" onclick="clearAllResults()">üóëÔ∏è Clear All</button>
                    </div>
                </div>

                <div id="resultsContainer">
                    <div class="empty-state">
                        <h3>üìã No Interviews Completed Yet</h3>
                        <p>Complete some interviews to see candidate results and rankings here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <form id="resultForm">
  <!-- form fields here -->
  <button type="submit">Submit Result</button>
</form>

<div id="statusMsg" style="margin-top: 10px; color: green;"></div>

<script>
  document.getElementById('resultForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = {
      name: document.getElementById('name').value,
      score: document.getElementById('score').value,
    };

    const response = await fetch('/submit-result', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(formData)
    });

    const result = await response.json();

    const msgDiv = document.getElementById('statusMsg');
    msgDiv.textContent = result.message;

    if (result.status === 'success') {
      msgDiv.style.color = 'green';
    } else {
      msgDiv.style.color = 'red';
    }
  });
</script>

<script>
  // Voice Interview System JavaScript
// Enhanced Voice Interview System JavaScript
class VoiceInterviewSystem {
    constructor() {
        this.recognition = null;
        this.synthesis = null;
        this.speechSynthesisUtterance = null;
        this.isListening = false;
        this.isInterviewActive = false;
        this.currentQuestionIndex = 0;
        this.questions = [];
        this.qaPairs = [];
        this.currentTranscript = '';
        this.candidateInfo = {};
        this.results = [];
        this.timer = null;
        
        this.initializeSpeechAPI();
        this.bindEvents();
        this.loadResults();
    }

    initializeSpeechAPI() {
        // Check speech synthesis support
        if (!('speechSynthesis' in window)) {
            this.showStatus('error', 'Speech synthesis is not supported in your browser. Please use Chrome, Firefox, or Safari.');
            return;
        }
        
        // Check speech recognition support
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            this.showStatus('error', 'Speech recognition is not supported in your browser. Please use Chrome or Safari.');
            return;
        }

        // Initialize Speech Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        this.recognition = new SpeechRecognition();
        this.recognition.continuous = true;
        this.recognition.interimResults = true;
        this.recognition.lang = 'en-US';
        this.recognition.maxAlternatives = 1;

        // Initialize Speech Synthesis
        this.synthesis = window.speechSynthesis;

        this.showStatus('success', 'üöÄ Voice interview system ready and optimized!');
    }

    bindEvents() {
        // Wait for page to load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page loaded, setting up event listeners...');
        });

        // File input events
        const resumeInput = document.getElementById('resume');
        const jdInput = document.getElementById('jd');
        
        if (resumeInput) resumeInput.addEventListener('change', this.handleFileSelect.bind(this));
        if (jdInput) jdInput.addEventListener('change', this.handleFileSelect.bind(this));
        
        // Button events
        const startInterviewBtn = document.getElementById('startInterview');
        const startVoiceBtn = document.getElementById('startInterviewVoice');
        const stopBtn = document.getElementById('stopButton');
        const newInterviewBtn = document.getElementById('startNewInterview');
        const sortSelect = document.getElementById('sortBy');
        
        if (startInterviewBtn) startInterviewBtn.addEventListener('click', this.generateQuestions.bind(this));
        if (startVoiceBtn) startVoiceBtn.addEventListener('click', this.startVoiceInterview.bind(this));
        if (stopBtn) stopBtn.addEventListener('click', this.stopCurrentAnswer.bind(this));
        if (newInterviewBtn) newInterviewBtn.addEventListener('click', this.startNewInterview.bind(this));
        if (sortSelect) sortSelect.addEventListener('change', this.sortResults.bind(this));
    }

    handleFileSelect(event) {
        const file = event.target.files[0];
        const container = event.target.closest('.file-input-container');
        const label = container?.querySelector('.file-label');
        
        if (file && label) {
            label.innerHTML = `<strong>‚úÖ ${file.name}</strong><br><small>File selected successfully</small>`;
            if (container) {
                container.style.borderColor = 'rgba(129, 251, 184, 0.4)';
                container.style.background = 'rgba(129, 251, 184, 0.1)';
            }
        }
    }

    async generateQuestions() {
        const candidateNameEl = document.getElementById('candidateName');
        const candidateEmailEl = document.getElementById('candidateEmail');
        const candidatePositionEl = document.getElementById('candidatePosition');
        const resumeFile = document.getElementById('resume')?.files[0];
        const jdFile = document.getElementById('jd')?.files[0];

        const candidateName = candidateNameEl?.value.trim() || '';
        const candidateEmail = candidateEmailEl?.value.trim() || '';
        const candidatePosition = candidatePositionEl?.value.trim() || '';

        if (!candidateName && candidateNameEl) {
            this.showStatus('error', 'Please enter candidate name');
            return;
        }

        if (!resumeFile || !jdFile) {
            this.showStatus('error', '‚ö†Ô∏è Please upload both files to continue.');
            return;
        }

        this.candidateInfo = {
            name: candidateName,
            email: candidateEmail,
            position: candidatePosition
        };

        this.showStatus('success', 'üîÑ Uploading files and generating intelligent questions...');
        const startBtn = document.getElementById('startInterview');
        if (startBtn) {
            startBtn.disabled = true;
            startBtn.classList.add('pulse');
        }

        const formData = new FormData();
        formData.append('resume', resumeFile);
        formData.append('jd', jdFile);

        try {
            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            console.log('Upload response:', result);

            if (result.status === 'success') {
                this.questions = result.result?.questions || [];
                console.log('Questions loaded:', this.questions.length, 'questions');
                
                if (this.questions.length === 0) {
                    this.showStatus('error', '‚ùå No questions were generated. Please check your files and try again.');
                    if (startBtn) {
                        startBtn.disabled = false;
                        startBtn.classList.remove('pulse');
                    }
                    return;
                }
                
                this.showAudioControls();
                this.showStatus('success', `‚úÖ Perfect! ${this.questions.length} intelligent questions generated. Ready for your voice interview.`);
                if (startBtn) startBtn.classList.remove('pulse');
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            console.error('Upload error:', error);
            this.showStatus('error', `‚ùå Upload failed: ${error.message}`);
        } finally {
            if (startBtn) {
                startBtn.disabled = false;
                startBtn.classList.remove('pulse');
            }
        }
    }

    showAudioControls() {
        const audioControls = document.getElementById('audioControls');
        if (audioControls) {
            audioControls.classList.remove('hidden');
            
            const currentNameEl = document.getElementById('currentName');
            const currentEmailEl = document.getElementById('currentEmail');
            const currentPositionEl = document.getElementById('currentPosition');
            
            if (currentNameEl) currentNameEl.textContent = this.candidateInfo.name;
            if (currentEmailEl) currentEmailEl.textContent = this.candidateInfo.email || 'Not provided';
            if (currentPositionEl) currentPositionEl.textContent = this.candidateInfo.position || 'Not specified';
            
            // Scroll to audio controls
            audioControls.scrollIntoView({ behavior: 'smooth' });
        }
    }

    async startVoiceInterview() {
        console.log('Start Voice Interview clicked');
        
        if (this.isInterviewActive) {
            this.showStatus('error', '‚ö†Ô∏è Interview is already in progress.');
            return;
        }
        
        if (this.questions.length === 0) {
            this.showStatus('error', '‚ö†Ô∏è No questions available. Please upload files first.');
            return;
        }
        
        this.isInterviewActive = true;
        this.currentQuestionIndex = 0;
        this.qaPairs = [];
        
        // Show interview is starting
        const currentQuestionEl = document.getElementById('currentQuestion');
        const transcriptEl = document.getElementById('transcript');
        const answerEl = document.getElementById('answer');
        
        if (currentQuestionEl) currentQuestionEl.innerHTML = 'üöÄ <span class="pulse">Starting your interview...</span>';
        if (transcriptEl) transcriptEl.textContent = '';
        if (answerEl) answerEl.textContent = '';
        
        const startVoiceBtn = document.getElementById('startInterviewVoice');
        if (startVoiceBtn) startVoiceBtn.disabled = true;
        
        console.log('Starting voice interview with', this.questions.length, 'questions');
        this.runVoiceInterview();
    }

    runVoiceInterview() {
        if (this.currentQuestionIndex >= this.questions.length) {
            console.log('Interview completed');
            this.isInterviewActive = false;
            const startVoiceBtn = document.getElementById('startInterviewVoice');
            if (startVoiceBtn) startVoiceBtn.disabled = false;
            
            this.speak("üéâ Interview completed successfully! Thank you for your time. Now calculating your scores...", () => {
                setTimeout(() => this.submitTranscriptForScoring(), 2000);
            });
            return;
        }

        const question = this.questions[this.currentQuestionIndex];
        console.log(`Question ${this.currentQuestionIndex + 1}/${this.questions.length}: ${question}`);
        
        const currentQuestionEl = document.getElementById('currentQuestion');
        const transcriptEl = document.getElementById('transcript');
        const answerEl = document.getElementById('answer');
        
        if (currentQuestionEl) {
            currentQuestionEl.innerHTML = `
                <strong>Question ${this.currentQuestionIndex + 1} of ${this.questions.length}:</strong><br><br>
                ${question}
            `;
        }
        if (transcriptEl) transcriptEl.innerHTML = 'üéØ <span class="pulse">Preparing to ask question...</span>';
        if (answerEl) answerEl.textContent = '';

        // Add a delay to ensure UI updates before speaking
        setTimeout(() => {
            this.speak(question, () => {
                console.log('Question spoken, starting to listen...');
                setTimeout(() => this.startListening(question), 1000);
            });
        }, 1000);
    }

    speak(text, callback) {
        console.log('Speaking:', text.substring(0, 50) + '...');
        
        // Cancel any ongoing speech
        if (this.synthesis) {
            this.synthesis.cancel();
        }
        
        // Wait for cancellation to complete
        setTimeout(() => {
            if (!text || text.trim() === '') {
                console.error('Empty text to speak');
                if (callback) callback();
                return;
            }
            
            this.speechSynthesisUtterance = new SpeechSynthesisUtterance(text);
            this.speechSynthesisUtterance.lang = 'en-US';
            this.speechSynthesisUtterance.rate = 0.8;
            this.speechSynthesisUtterance.pitch = 1.0;
            this.speechSynthesisUtterance.volume = 0.9;
            
            this.speechSynthesisUtterance.onstart = () => {
                console.log('Speech started');
            };
            
            this.speechSynthesisUtterance.onend = () => {
                console.log('Speech ended');
                if (callback) {
                    setTimeout(callback, 500);
                }
            };
            
            this.speechSynthesisUtterance.onerror = (event) => {
                console.error('Speech error:', event.error);
                if (callback) {
                    setTimeout(callback, 500);
                }
            };
            
            try {
                if (this.synthesis) {
                    this.synthesis.speak(this.speechSynthesisUtterance);
                }
            } catch (error) {
                console.error('Speech synthesis error:', error);
                if (callback) callback();
            }
        }, 200);
    }

    startListening(question) {
        console.log('Starting speech recognition for question:', question.substring(0, 30) + '...');
        
        if (!this.recognition) {
            this.showStatus('error', 'Speech recognition not supported');
            return;
        }

        try {
            let finalTranscript = "";
            this.isListening = false;

            // Reset recognition handlers
            this.recognition.onstart = () => {
                console.log('Speech recognition started');
                this.isListening = true;
                const transcriptEl = document.getElementById('transcript');
                if (transcriptEl) {
                    transcriptEl.innerHTML = `
                        üé§ <span class="listening-indicator">
                            <span class="listening-dot"></span>
                            <span class="listening-dot"></span>
                            <span class="listening-dot"></span>
                        </span> 
                        Listening... Please speak your answer clearly.
                    `;
                }
            };

            this.recognition.onresult = (event) => {
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                const displayText = (finalTranscript + interimTranscript).trim();
                const transcriptEl = document.getElementById('transcript');
                if (displayText && transcriptEl) {
                    transcriptEl.textContent = displayText;
                }
            };

            this.recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                this.isListening = false;
                clearTimeout(this.timer);
                
                let errorMessage = '‚ùå Speech recognition error: ';
                switch(event.error) {
                    case 'no-speech':
                        errorMessage += 'No speech detected. Please try again.';
                        break;
                    case 'audio-capture':
                        errorMessage += 'Microphone not found. Please check your microphone.';
                        break;
                    case 'not-allowed':
                        errorMessage += 'Microphone access denied. Please allow microphone access and refresh the page.';
                        break;
                    case 'network':
                        errorMessage += 'Network error. Please check your internet connection.';
                        break;
                    default:
                        errorMessage += event.error;
                }
                
                this.showStatus('error', errorMessage);
                
                // Ask if user wants to retry or skip
                if (confirm('Would you like to try again? Click Cancel to skip this question.')) {
                    setTimeout(() => this.startListening(question), 2000);
                } else {
                    // Skip this question
                    this.currentQuestionIndex++;
                    setTimeout(() => this.runVoiceInterview(), 1000);
                }
            };

            this.recognition.onend = () => {
                console.log('Speech recognition ended');
                this.isListening = false;
                clearTimeout(this.timer);

                const answer = finalTranscript.trim();
                
                if (!answer || answer.length < 3) {
                    console.log('No valid answer detected');
                    const transcriptEl = document.getElementById('transcript');
                    if (transcriptEl) transcriptEl.textContent = 'No clear answer detected.';
                    
                    if (confirm('No clear answer was detected. Would you like to try again?')) {
                        setTimeout(() => this.startListening(question), 2000);
                        return;
                    } else {
                        // Use "No response" as answer
                        finalTranscript = "No response provided";
                    }
                }

                const finalAnswer = finalTranscript.trim() || "No response provided";
                console.log('Final answer:', finalAnswer.substring(0, 50) + '...');
                
                this.qaPairs.push({ question, answer: finalAnswer });
                const answerEl = document.getElementById('answer');
                if (answerEl) answerEl.textContent = finalAnswer;

                // Save the answer
                this.saveTranscript(question, finalAnswer);

                // Move to next question
                this.currentQuestionIndex++;
                setTimeout(() => this.runVoiceInterview(), 2000);
            };

            this.recognition.start();

            // Auto stop after 2 minutes
            this.timer = setTimeout(() => {
                console.log('Auto-stopping recognition after 2 minutes');
                if (this.isListening) {
                    this.recognition.stop();
                }
            }, 60000);

        } catch (error) {
            console.error('Error starting speech recognition:', error);
            this.showStatus('error', '‚ùå Failed to start speech recognition: ' + error.message);
        }
    }

    stopCurrentAnswer() {
        console.log('Manual stop clicked');
        clearTimeout(this.timer);
        if (this.isListening && this.recognition) {
            this.recognition.stop();
        }
    }

    async saveTranscript(question, answer) {
        try {
            const response = await fetch('/save-transcript', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    question: question,
                    answer: answer
                })
            });

            if (!response.ok) {
                console.error('Failed to save transcript');
            }
            const data = await response.json();
            console.log('Transcript saved:', data);
        } catch (error) {
            console.error('Error saving transcript:', error);
        }
    }

    async submitTranscriptForScoring() {
        console.log('Submitting transcript for scoring...');
        
        const currentQuestionEl = document.getElementById('currentQuestion');
        const transcriptEl = document.getElementById('transcript');
        
        if (currentQuestionEl) currentQuestionEl.innerHTML = 'üìä <span class="pulse">Calculating your scores...</span>';
        if (transcriptEl) transcriptEl.textContent = 'Please wait while we analyze your responses with advanced AI...';
        
        try {
            const response = await fetch('/score-transcript');
            
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            
            const data = await response.json();
            console.log('Scoring data received:', data);

            if (data.status !== 'success') {
                this.showStatus('error', '‚ùå Error fetching score: ' + data.message);
                return;
            }

            // Display results
            this.displayScores(data.scores);
        } catch (error) {
            console.error('Error fetching score:', error);
            this.showStatus('error', '‚ùå Error calculating scores: ' + error.message);
        }
    }

    displayScores(scores) {
        const currentQuestionEl = document.getElementById('currentQuestion');
        const transcriptEl = document.getElementById('transcript');
        const scoreListEl = document.getElementById('scoreList');
        const overallScoreEl = document.getElementById('overallScore');
        
        if (currentQuestionEl) currentQuestionEl.innerHTML = 'üéØ <strong>Interview Complete - Results Ready</strong>';
        if (transcriptEl) transcriptEl.textContent = '‚ú® Thank you for completing the interview! Your results are displayed below.';
        
        if (scoreListEl) {
            scoreListEl.innerHTML = '';
            
            if (scores && scores.scores && Array.isArray(scores.scores)) {
                scores.scores.forEach((scoreObj, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <strong>${scoreObj.progress}</strong><br>
                        <span style="font-size: 1.2em; font-weight: 600;">Score: ${scoreObj.score}%</span>
                    `;
                    li.className = 'score-item';
                    
                    // Color coding based on score
                    if (scoreObj.score >= 70) {
                        li.style.background = 'rgba(129, 251, 184, 0.15)';
                        li.style.borderColor = 'rgba(129, 251, 184, 0.3)';
                        li.style.color = '#10b981';
                    } else if (scoreObj.score >= 50) {
                        li.style.background = 'rgba(255, 211, 61, 0.15)';
                        li.style.borderColor = 'rgba(255, 211, 61, 0.3)';
                        li.style.color = '#f59e0b';
                    } else {
                        li.style.background = 'rgba(255, 107, 107, 0.15)';
                        li.style.borderColor = 'rgba(255, 107, 107, 0.3)';
                        li.style.color = '#ef4444';
                    }
                    
                    scoreListEl.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = 'No detailed scores available';
                li.className = 'score-item';
                scoreListEl.appendChild(li);
            }
        }

        if (overallScoreEl) {
            if (scores && !isNaN(scores.overall)) {
                const overall = scores.overall;
                overallScoreEl.innerHTML = `
                    <div style="margin-bottom: 8px;">Overall Performance</div>
                    <div style="font-size: 3rem;">${overall.toFixed(1)}%</div>
                    <div style="font-size: 1rem; opacity: 0.8;">
                        ${overall >= 70 ? 'üéâ Excellent Performance!' : overall >= 50 ? 'üëç Good Performance!' : 'üí™ Room for Improvement'}
                    </div>
                `;
                overallScoreEl.style.color = overall >= 70 ? '#10b981' : overall >= 50 ? '#f59e0b' : '#ef4444';
            } else {
                overallScoreEl.innerHTML = `
                    <div style="font-size: 1.5rem;">Overall score not available</div>
                `;
            }
        }
        
        // Show completion message
        setTimeout(() => {
            const finalScore = scores.overall ? scores.overall.toFixed(1) + '%' : 'not available';
            this.showStatus('success', `üéâ Interview completed successfully! Your overall score is ${finalScore}`);
        }, 1000);

        // Save to results
        if (scores && scores.overall) {
            this.saveInterviewResult(scores);
        }
    }

    saveInterviewResult(scores) {
        const result = {
            id: Date.now(),
            name: this.candidateInfo.name,
            email: this.candidateInfo.email,
            position: this.candidateInfo.position,
            score: Math.round(scores.overall),
            timestamp: new Date().toISOString(),
            qaPairs: this.qaPairs,
            detailedScores: scores.scores || []
        };

        this.results.push(result);
        this.saveResults();
    }

    startNewInterview() {
        // Reset form
        const candidateNameEl = document.getElementById('candidateName');
        const candidateEmailEl = document.getElementById('candidateEmail');
        const candidatePositionEl = document.getElementById('candidatePosition');
        const resumeEl = document.getElementById('resume');
        const jdEl = document.getElementById('jd');
        
        if (candidateNameEl) candidateNameEl.value = '';
        if (candidateEmailEl) candidateEmailEl.value = '';
        if (candidatePositionEl) candidatePositionEl.value = '';
        if (resumeEl) resumeEl.value = '';
        if (jdEl) jdEl.value = '';
        
        // Reset file input displays
        document.querySelectorAll('.file-input-container').forEach(container => {
            const label = container.querySelector('.file-label');
            const input = container.querySelector('input');
            if (label && input) {
                const isResume = input.id === 'resume';
                label.innerHTML = isResume ? 
                    '<strong>Upload Resume</strong><br><small>PDF, DOCX, or TXT format</small>' :
                    '<strong>Upload Job Description</strong><br><small>PDF, DOCX, or TXT format</small>';
                container.style.borderColor = 'var(--glass-border)';
                container.style.background = 'rgba(255, 255, 255, 0.05)';
            }
        });

        // Hide audio controls
        const audioControls = document.getElementById('audioControls');
        const startNewBtn = document.getElementById('startNewInterview');
        if (audioControls) audioControls.classList.add('hidden');
        if (startNewBtn) startNewBtn.classList.add('hidden');
        
        // Reset state
        this.currentQuestionIndex = 0;
        this.questions = [];
        this.qaPairs = [];
        this.candidateInfo = {};
        this.isInterviewActive = false;
        
        // Clear status
        const uploadStatus = document.getElementById('uploadStatus');
        if (uploadStatus) uploadStatus.innerHTML = '';
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    showStatus(type, message) {
        const statusDiv = document.getElementById('uploadStatus');
        if (statusDiv) {
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }
    }

    // Results Management
    loadResults() {
        try {
            const saved = localStorage.getItem('voiceInterviewResults');
            if (saved) {
                this.results = JSON.parse(saved);
            }
        } catch (error) {
            console.error('Error loading results:', error);
            this.results = [];
        }
    }

    saveResults() {
        try {
            localStorage.setItem('voiceInterviewResults', JSON.stringify(this.results));
        } catch (error) {
            console.error('Error saving results:', error);
        }
    }

    sortResults() {
        const sortByEl = document.getElementById('sortBy');
        if (!sortByEl) return;
        
        const sortBy = sortByEl.value;
        
        this.results.sort((a, b) => {
            switch (sortBy) {
                case 'score':
                    return b.score - a.score;
                case 'name':
                    return a.name.localeCompare(b.name);
                case 'timestamp':
                    return new Date(b.timestamp) - new Date(a.timestamp);
                default:
                    return 0;
            }
        });
        
        this.displayResultsTable();
    }

    displayResultsTable() {
        const container = document.getElementById('resultsContainer');
        if (!container) return;
        
        if (this.results.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>üìã No Interviews Completed Yet</h3>
                    <p>Complete some interviews to see candidate results and rankings here.</p>
                </div>
            `;
            return;
        }

        let tableHTML = `
            <div class="results-table">
                <div class="table-header">
                    <div>Candidate Details</div>
                    <div>Overall Score</div>
                    <div>Interview Date</div>
                    <div>Actions</div>
                </div>
        `;

        this.results.forEach((result, index) => {
            const date = new Date(result.timestamp).toLocaleDateString();
            const scoreBadgeClass = this.getScoreBadgeClass(result.score);
            
            tableHTML += `
                <div class="table-row" data-index="${index}">
                    <div>
                        <strong>${result.name}</strong><br>
                        <small style="opacity: 0.7;">${result.position || 'Position not specified'}</small><br>
                        <small style="opacity: 0.6;">${result.email || 'Email not provided'}</small>
                    </div>
                    <div>
                        <span class="score-badge ${scoreBadgeClass}">${result.score}%</span>
                    </div>
                    <div>${date}</div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary btn-small" onclick="voiceSystem.viewDetails(${index})">
                            üëÅÔ∏è View
                        </button>
                        <button class="btn btn-danger btn-small" onclick="voiceSystem.deleteResult(${index})">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
            `;
        });

        tableHTML += '</div>';
        container.innerHTML = tableHTML;
    }

    getScoreBadgeClass(score) {
        if (score >= 80) return 'score-excellent';
        if (score >= 60) return 'score-good';
        return 'score-poor';
    }

    viewDetails(index) {
        const result = this.results[index];
        const categories = result.detailedScores || [];
        const categoryText = categories.length > 0 ? 
            categories.map(cat => `${cat.progress}: ${cat.score}%`).join('\n') :
            'No detailed breakdown available';
            
        alert(`
Candidate: ${result.name}
Position: ${result.position || 'Not specified'}
Email: ${result.email || 'Not provided'}
Overall Score: ${result.score}%
Interview Date: ${new Date(result.timestamp).toLocaleString()}

Category Breakdown:
${categoryText}
        `);
    }

    deleteResult(index) {
        if (confirm('Are you sure you want to delete this interview result?')) {
            this.results.splice(index, 1);
            this.saveResults();
            this.displayResultsTable();
        }
    }
}

// Navigation Functions
function showSection(sectionName) {
    // Hide all sections
    document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Remove active class from all nav buttons
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected section
    const targetSection = document.getElementById(sectionName);
    if (targetSection) targetSection.classList.add('active');
    
    // Add active class to clicked button
    if (event && event.target) {
        event.target.classList.add('active');
    }
    
    // Load results if results section is selected
    if (sectionName === 'results' && window.voiceSystem) {
        window.voiceSystem.displayResultsTable();
    }
}

// Results Dashboard Functions
function refreshResults() {
    voiceSystem.displayResultsTable();
    voiceSystem.showStatus('success', 'Results refreshed successfully');
}

function exportResults() {
    if (voiceSystem.results.length === 0) {
        alert('No results to export');
        return;
    }

    const csvContent = [
        ['Name', 'Email', 'Position', 'Overall Score', 'Interview Date'],
        ...voiceSystem.results.map(result => [
            result.name,
            result.email || '',
            result.position || '',
            result.score,
            new Date(result.timestamp).toLocaleDateString()
        ])
    ].map(row => row.join(',')).join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'interview_results.csv';
    a.click();
    window.URL.revokeObjectURL(url);
}

function clearAllResults() {
    if (confirm('Are you sure you want to delete all interview results? This action cannot be undone.')) {
        voiceSystem.results = [];
        voiceSystem.saveResults();
        voiceSystem.displayResultsTable();
        voiceSystem.showStatus('success', 'All results cleared successfully');
    }
}

// Initialize the system
let voiceSystem;
document.addEventListener('DOMContentLoaded', () => {
    voiceSystem = new VoiceInterviewSystem();
});
</script>
</body>
</html>
